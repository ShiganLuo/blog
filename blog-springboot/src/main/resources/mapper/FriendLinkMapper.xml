<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.baofeng.blog.mapper.FriendLinkMapper">
    <resultMap id="FriendLinkResultMap"
               type="com.baofeng.blog.entity.FriendLink">

        <id property="id" column="id"/>
        <result property="siteName" column="site_name"/>
        <result property="siteDesc" column="site_desc"/>
        <result property="siteLogo" column="site_logo"/>
        <result property="siteUrl" column="site_url"/>
        <result property="userId" column="user_id"/>
        <result property="status" column="status"/>
        <result property="sortOrder" column="sort_order"/>
        <result property="isVisible" column="is_visible"/>
        <result property="applyMessage" column="apply_message"/>

        <result property="createdAt" column="created_at"/>
        <result property="updatedAt" column="updated_at"/>
    </resultMap>

    <resultMap id="FrontFriendLinkResultMap" type="com.baofeng.blog.dto.front.FrontFriendLinkDTO$FrontFriendLinkItem">
        <id property="id" column="id"/>
        <result property="siteName" column="site_name"/>
        <result property="siteDesc" column="site_desc"/>
        <result property="siteLogo" column="site_logo"/>
        <result property="siteUrl" column="site_url"/>
        <result property="userId" column="user_id"/>
    </resultMap>
    <!--获取所有友链-前台-->
    <select id="getAllFriendLinksFront" resultMap="FrontFriendLinkResultMap">
        SELECT
            id,
            site_name,
            site_desc,
            site_logo,
            site_url,
            user_id,
        FROM friend_link
        WHERE status = 1
          AND is_visible = 1
        ORDER BY sort_order ASC, created_at DESC
    </select>

    <resultMap id="AdminFriendLinkResultMap" type="com.baofeng.blog.dto.admin.AdminFriendLinkDTO$AdminFriendLinkItem">
        <id property="id" column="id"/>
        <result property="siteName" column="site_name"/>
        <result property="siteDesc" column="site_desc"/>
        <result property="siteLogo" column="site_logo"/>
        <result property="siteUrl" column="site_url"/>
        <result property="userId" column="user_id"/>
        <result property="createdAt" column="created_at"/>
        <result property="updatedAt" column="updated_at"/>
    </resultMap>
    <!--获取所有友链-后台-->
    <select id="getAllFriendLinksForAdmin" resultMap="AdminFriendLinkResultMap">
        SELECT
            id,
            site_name,
            site_desc,
            site_logo,
            site_url,
            user_id,
            created_at,
            updated_at
        FROM friend_link
        <where>
        <if test="keyword != null and keyword != ''">
                AND (site_name LIKE CONCAT('%', #{keyword}, '%') 
                OR site_desc LIKE CONCAT('%', #{keyword}, '%'))
            </if>
        </where>
        ORDER BY created_at DESC
    </select>

    <!--根据id查询友链-->
    <select id="getFriendLinkById" resultMap="FriendLinkResultMap">
        SELECT
            id,
            site_name,
            site_desc,
            site_logo,
            site_url,
            user_id,
            status,
            sort_order,
            is_visible,
            apply_message,
            created_at,
            updated_at
        FROM friend_link
        WHERE id = #{id}
    </select>

    <!--增加友链-->
    <insert id="insertFriendLink"
            useGeneratedKeys="true"
            keyProperty="id">
        INSERT INTO friend_link (
            site_name,
            site_desc,
            site_logo,
            site_url,
            user_id,
            status,
            is_visible,
            sort_order,
            apply_message,
            created_at,
            updated_at
        ) VALUES (
            #{siteName},
            #{siteDesc},
            #{siteLogo},
            #{siteUrl},
            #{userId},
            0,
            0,
            0,
            #{applyMessage},
            CURRENT_TIMESTAMP,
            CURRENT_TIMESTAMP
        )
    </insert>

    <!--更新友链-->
    <update id="updateFriendLinkById">
        UPDATE friend_link
        <set>
            <if test="siteName != null">
                site_name = #{siteName},
            </if>
            <if test="siteDesc != null">
                site_desc = #{siteDesc},
            </if>
            <if test="siteLogo != null">
                site_logo = #{siteLogo},
            </if>
            <if test="siteUrl != null">
                site_url = #{siteUrl},
            </if>
            <if test="status != null">
                status = #{status},
            </if>
            <if test="isVisible != null">
                is_visible = #{isVisible},
            </if>
            <if test="sortOrder != null">
                sort_order = #{sortOrder},
            </if>
            <if test="applyMessage != null">
                apply_message = #{applyMessage},
            </if>
            updated_at = CURRENT_TIMESTAMP
        </set>
        WHERE id = #{id}
    </update>

    <!--批量删除友链-->
    <delete id="deleteFriendLinksByIds">
        DELETE FROM friend_link
        WHERE id IN
        <foreach collection="ids" item="id" open="(" separator="," close=")">
            #{id}
        </foreach>
    </delete>

</mapper>
